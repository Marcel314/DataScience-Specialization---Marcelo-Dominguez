{
    "contents" : "# DataScience Specialization - R Programming\n# Assigment3 - Hospital Quality\n# by Marcelo Dom√≠nguez\n# @_marcelo_d \n\n\n# Configuration\n# - Setting packages and working directory\n# - Downloaded raw data and unzip to \"./in\" folder\nsetup <- function() {\n  cat(\"Setup\")\n  install.packages(\"downloader\")\n  library(downloader)\n  sapply(packages, require, character.only=TRUE, quietly=TRUE)\n  setwd(\"./\")\n  path = getwd()\n  path\n  url = \"https://d396qusza40orc.cloudfront.net/rprog%2Fdata%2FProgAssignment3-data.zip\"\n  datasetFile = \"assignment-dataset.zip\"\n  download(url, dest=datasetFile, mode=\"wb\") \n  if (file.exists(\"./in\")) {\n    unlink(\"./in\",recursive=TRUE,force=TRUE)\n  } else {\n    dir.create(\"./in\", showWarnings = FALSE, recursive = FALSE, mode = \"0777\")\n  }\n  unzip(datasetFile, exdir = \"./in\")\n  cat(\"Setup: ok\")\n}\n\n# Get outcome columnName\ngetOutcomeColumn <- function(outcome) {\n  if (outcome == \"heart attack\") {\n    outcome <- \"Hospital.30.Day.Death..Mortality..Rates.from.Heart.Attack\"\n  } else if (outcome == \"heart failure\") {\n    outcome <- \"Hospital.30.Day.Death..Mortality..Rates.from.Heart.Failure\"\n  } else if (outcome == \"pneumonia\") {\n    outcome <- \"Hospital.30.Day.Death..Mortality..Rates.from.Pneumonia\"\n  }\n}\n\n# rankall\n#\n# The function reads the outcome-of-care-measures.csv file and returns a 2-column data frame containing \n# the hospital in each state that has the ranking specified in num. \n# For example the function call rankall(\"heart attack\", \"best\") would return a data frame containing the \n# names of the hospitals that are the best in their respective states for 30-day heart attack death rates. \n# The function should return a value for every state (some may be NA). \n# The first column in the data frame is named hospital, which contains the hospital name, and the second \n# column is named state, which contains the 2-character abbreviation for the state name. \n# Hospitals that do not have data on a particular outcome should be excluded from the set of hospitals\n# when deciding the rankings.\n#\n# If the number given by num is larger than the number of hospitals in that state, \n# then the function should return NA.\nrankall <- function(outcome, num=\"best\") {\n  \n  ## Read outcome data\n  measures = read.csv(\"./in/outcome-of-care-measures.csv\", colClasses = \"character\")\n  \n  ## Check that state, outcome and num parameters are valid\n  if (!is.element(state,measures[,7])) {\n    stop(\"invalid state\")\n  }\n  \n  if (!is.element(outcome,c('heart attack','heart failure','pneumonia'))) {\n    stop(\"invalid outcome\")\n  }\n  \n  if (!is.element(num,c('best','worst'))) {\n    if (!suppressWarnings(as.numeric(num)) <= nrow(measures)) {\n      return(NA)\n    } \n  } \n  \n  ## Return hospital name in that state with the given rank 30-day death rate\n  outcomeColumn = getOutcomeColumn(outcome)\n  measures <- measures[measures$State==state,]\n  measures[,outcomeColumn] <- suppressWarnings(as.numeric(measures[,outcomeColumn]))\n  measures <- measures[order(measures[outcomeColumn], measures$\"Hospital.Name\"),]\n  if (num == 'best') {\n    name = as.character(measures$\"Hospital.Name\"[!is.na(measures[outcomeColumn])][1])\n  } else if (num == 'worst') {\n    name = as.character(tail(measures$\"Hospital.Name\"[!is.na(measures[outcomeColumn])],1))\n  } else {\n    name = as.character(measures$\"Hospital.Name\"[!is.na(measures[outcomeColumn])][num])\n  }\n  \n  return(name)\n}\n\n\n",
    "created" : 1427407721480.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "9|21|27|0|\n30|39|38|0|\n",
    "hash" : "3186966039",
    "id" : "103C4CC3",
    "lastKnownWriteTime" : 1427408368,
    "path" : "~/Projects/datascience-specialization/GitHub-Repos/DS02-R-Programming/ProgrammingAssignment3/rankall.R",
    "project_path" : "rankall.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}